<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:file="http://www.mulesource.org/schema/mule/file/2.0"
  xmlns:xfire="http://www.mulesource.org/schema/mule/xfire/2.0"
  xmlns:mule="http://www.mulesource.org/schema/mule/core/2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:simple="http://www.mulesource.org/schema/mule/simple/2.0"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                      http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
                      http://www.mulesource.org/schema/mule/xfire/2.0 http://www.mulesource.org/schema/mule/xfire/2.0/mule-xfire.xsd">
<mule:mule>
 <!--  xsi:schemaLocation="
               http://www.springframework.org/schema/beans ./resources/schemas/spring-beans-2.0.xsd
               http://www.mulesource.org/schema/mule/core/2.0 ./resources/schemas/mule.xsd
               http://www.mulesource.org/schema/mule/xfire/2.0 ./resources/schemas/mule-xfire.xsd"
               >
 -->
  

    <xfire:connector name="generatedStub" enableJSR181Annotations="true" />
    <xfire:connector name="messageBased" 
                     bindingProviderClass="org.codehaus.xfire.service.binding.MessageBindingProvider"/>
    
    <beans>
      <bean name="CocServiceWebService" class="org.esb.opensource.coc.CoCServiceImpl">
        <property name="delegate" ref="CocServiceImpl"/>
      </bean>
      <bean name="CocServiceImpl" class="org.esb.chapter7.wsdl.CocServiceImpl" init-method="init"/>
    </beans>
  
  <mule:model name="wsdl-model">
    <!-- Calls directly to the service -->
    <mule:service name="cocService">     
      <mule:inbound-router>
        <mule:inbound-endpoint address="xfire:http://localhost:8081/services" connector-ref="generatedStub"/>
        <mule:wire-tap-router>
            <mule:outbound-endpoint address="file://dfjdkfjkd"></mule:outbound-endpoint>
        </mule:wire-tap-router>
      </mule:inbound-router>
      <mule:component>
          <mule:singleton-object instance-ref="CocServiceWebService"/>
      </mule:component>      
    </mule:service>

    <!-- Sends the message as an XMLStream which can be further processed -->
    <mule:service name="cocServiceMessageDriven">
      <mule:inbound-router>
        <mule:inbound-endpoint address="xfire:http://localhost:8082/services" connector-ref="messageBased"/>
      </mule:inbound-router>
      <mule:component class="org.esb.chapter7.wsdl.CoCMessageBinding"/>      
    </mule:service>    
  </mule:model>

</mule:mule>
</beans>
