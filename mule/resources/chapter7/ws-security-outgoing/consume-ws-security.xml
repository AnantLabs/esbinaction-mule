<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.0"
    xmlns:spring="http://www.springframework.org/schema/beans"
    xmlns:file="http://www.mulesource.org/schema/mule/file/2.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cxf="http://www.mulesource.org/schema/mule/cxf/2.0"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                      http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
                      http://www.mulesource.org/schema/mule/cxf/2.0 http://www.mulesource.org/schema/mule/cxf/2.0/mule-cxf.xsd
                      http://www.mulesource.org/schema/mule/file/2.0 http://www.mulesource.org/schema/mule/file/2.0/mule-file.xsd">

  <cxf:connector name="clientCxfConnector">
    <spring:property name="configurationLocation" value="esb/chapter7/wss-cxf-config-client.xml" />
  </cxf:connector>
  
  <cxf:connector name="serverCxfConnector">
    <spring:property name="configurationLocation" value="esb/chapter7/wss-cxf-config.xml" />
  </cxf:connector>
    
  <spring:bean name="ChamberOfCommerceServiceImpl" 
      class="esb.chapter7.ChamberOfCommerceServiceImpl" 
      init-method="init"/>

  <model name="consume-wsdl">
    <service name="cocServiceConsumeToJava">
      <inbound>
        <file:inbound-endpoint path="work-mule/chapter7/consume-wss/in">
          <byte-array-to-string-transformer />
        </file:inbound-endpoint>
      </inbound>
      <outbound>
        <chaining-router>
          <cxf:outbound-endpoint
            connector-ref="clientCxfConnector"
            address="http://localhost:8080/services/coc"
            wsdlLocation="http://localhost:8080/services/coc?wsdl"
            wsdlPort="{http://opensource.esb.org/CoC/}ChamberOfCommerceServiceImplPort"
            operation="getCompany" />
          <file:outbound-endpoint path="work-mule/chapter7/consume-wss/out">
            <custom-transformer class="esb.chapter7.SimpleTransfomer" />
          </file:outbound-endpoint>
        </chaining-router>
      </outbound>
    </service>

    <service name="cocService">
      <inbound>
        <cxf:inbound-endpoint address="http://localhost:8080/services/coc" 
            connector-ref="serverCxfConnector"/>
      </inbound>
      <component>
        <spring-object bean="ChamberOfCommerceServiceImpl"/>
      </component>
    </service>
  </model>
</mule>