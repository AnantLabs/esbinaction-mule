<?xml version="1.0" encoding="UTF-8"?>
<mule:mule xmlns="http://www.springframework.org/schema/beans"
  xmlns:file="http://www.mulesource.org/schema/mule/file/2.0"
  xmlns:xfire="http://www.mulesource.org/schema/mule/xfire/2.0"
  xmlns:xfire-wsdl="http://www.mulesource.org/schema/mule/wsdl-xfire/2.0"
  xmlns:mule="http://www.mulesource.org/schema/mule/core/2.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:simple="http://www.mulesource.org/schema/mule/simple/2.0"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
                      http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
                      http://www.mulesource.org/schema/mule/xfire/2.0 http://www.mulesource.org/schema/mule/xfire/2.0/mule-xfire.xsd
                      http://www.mulesource.org/schema/mule/wsdl-xfire/2.0 http://www.mulesource.org/schema/mule/wsdl-xfire/2.0/mule-wsdl-xfire.xsd">

    <xfire:connector name="testConnector"
      typeMappingRegistryClass="org.codehaus.xfire.jaxb2.JaxbTypeRegistry" />
      
      <mule:custom-transformer name="toStringTransformer" class="esb.chapter7.SimpleTransfomer"/>
  
  <mule:model name="consume-wsdl">

    <!-- Calls directly to the service -->
    <mule:service name="cocServiceConsumeToJava">
      <mule:inbound>
        <mule:inbound-endpoint
          address="file://work-mule/chapter7/consume-wsdl/in-to-java">
          <mule:byte-array-to-string-transformer />
        </mule:inbound-endpoint>
      </mule:inbound>
      <mule:outbound>
        <mule:chaining-router>
          <!-- Calls the Getcompany method -->
          <mule:outbound-endpoint
            address="wsdl-xfire:http://localhost:8181/CoCPortType?wsdl&amp;method=getCompany">
            <mule:properties>
              <entry key="complexTypes">
                <map>
                  <entry key="org.esb.opensource.coc.Company"
                    value="out:http://coc.opensource.esb.org" />
                </map>
              </entry>
            </mule:properties>
          </mule:outbound-endpoint>
          <mule:outbound-endpoint
            address="file://work-mule/chapter7/consume-wsdl/out">
            <mule:transformer ref="toStringTransformer"/>
          </mule:outbound-endpoint>
        </mule:chaining-router>
      </mule:outbound>
    </mule:service>

    <mule:service name="cocServiceConsumeToXML">
      <mule:inbound>
        <mule:inbound-endpoint
          address="file://work-mule/chapter7/consume-wsdl/in-to-xml">
          <mule:byte-array-to-string-transformer />
        </mule:inbound-endpoint>
      </mule:inbound>
      <mule:outbound>
        <mule:chaining-router>
          <!-- Calls the Getcompany method -->
          <mule:outbound-endpoint
            address="wsdl-xfire:http://localhost:8181/CoCPortType?wsdl&amp;method=getCompany">
          </mule:outbound-endpoint>
          <mule:outbound-endpoint
            address="file://work-mule/chapter7/consume-wsdl/out">
            <mule:transformer ref="toStringTransformer"/>
          </mule:outbound-endpoint>
        </mule:chaining-router>
      </mule:outbound>
    </mule:service>

  </mule:model>

</mule:mule>
