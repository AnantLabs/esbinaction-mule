<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.0"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:spring="http://www.springframework.org/schema/beans"
       xmlns:jms="http://www.mulesource.org/schema/mule/jms/2.0"
       xmlns:jotm="http://www.mulesource.org/schema/mule/jotm/2.0"
    xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
       http://www.mulesource.org/schema/mule/jms/2.0 http://www.mulesource.org/schema/mule/jms/2.0/mule-jms.xsd
       http://www.mulesource.org/schema/mule/jotm/2.0 http://www.mulesource.org/schema/mule/jotm/2.0/mule-jotm.xsd">
    
    <spring:bean name="txFactory" class="org.mule.providers.jms.JmsTransactionFactory" />
    
    <jms:activemq-connector name="jmsConnector" maxRedelivery="1">
		<jms:connection-factory class="org.apache.activemq.ActiveMQConnectionFactory"/>
	</jms:activemq-connector>
    
    <model name="TransactionExample">
		<service name="TransactionalJMSService">
			<inbound-router>
                <inbound-endpoint address="jms://transaction.in">
					<transaction action="ALWAYS_BEGIN">
						<transaction-factory ref="txFactory"/>
					</transaction>
                </inbound-endpoint>
            </inbound-router>
           	<component class="esb.chapter8.transaction.service.TransactionService"/>
       		<outbound-router>
       			<outbound-pass-through-router>
       				<outbound-endpoint address="jms://transaction.out"/>
       			</outbound-pass-through-router>
       		</outbound-router>
		</service>
	</model>
</mule>

